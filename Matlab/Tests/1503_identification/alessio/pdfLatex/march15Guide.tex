\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\author{Alessio Russo}
\title{Test1}
\begin{document}
\tableofcontents

\section{Introduzione}
Rotazione del disco attaccato al motore: $\theta_m$. \\
Raggio del disco attaccato al motore: $R_d$. \\
Posizione del carretto : $x$. \\
Tensione in ingresso al motore: $V$ \\
Stiffness molla: $K$ \\
Resistenza e induttanza del motore: $R,L$ \\
Massa carretto+peso: $M$ \\
Costante torque/backemf: $K_e$

Essendo il gearbox fissato al carretto abbiamo:
$$\dot{\theta}_m = \frac{x}{R_d} $$

Funzione di trasferimento tra forza erogata e posizione del carretto:
$$\frac{X}{F}(s) = \frac{1}{M} \frac{1}{s^2+\frac{K}{M}}$$

Funzione di trasferimento tra Tensione e corrente:
$$\frac{I}{V}(s) = \frac{s^2+\frac{K}{M}}{(s^2+\frac{K}{M})(2R+2sL)+\gamma }$$
$$\gamma = \frac{4K_e^2}{R_d^2M}$$
Per $\gamma \ll 1$:
$$\frac{I}{V} \approx \frac{1}{2R+2sL}$$
NB: $\gamma > 0$.
\newpage
\section{Ricavare $k$}
Per ricavare le $k$ delle molle l'idea generale è di guardare il displacement $x$ del carretto applicando la stessa forza $F(t)$. \\ \\
Per $F(t)=F_0$ abbiamo $x(t) \to kF_0$. \\
Chiamiamo le due molle $k_1,k_2$. Noi non conosciamo $F_0$, ma è costante per entrambi e cambia solo il $k$. Quindi:
$$F_0 = k_1 x_1$$
$$F_0 = k_2 x_2$$
Quindi prendendo il rapporto:

$$\frac{x_1}{x_2} = \frac{k_2}{k_1}$$
Se $x_2 < x_1$ allora $k_2 > k_1$, e viceversa.  Da questa formula possiamo ricavare il rapporto fra le due $k$ e verificare con quelle scritte nel manuale. \\ \\
Quindi:
\begin{enumerate}
\item Aprire il file simulink test1 nella cartella tests/15March.
\item Caricare lo schema sulla scheda
\item Attaccare la prima molla
\item Far andare la scheda, calcolare $x_1$ quando il carretto è fermo
\item Spegnere la scheda, staccare la molla e attaccare l'altra molla
\item Far andare la scheda, calcolare $x_2$ e prendere il rapporto
\end{enumerate}
\newpage
\section{Ricavare $K_e$ e stimare $\gamma$}
Conoscendo ora la forza, e sapendo $R_d$, sappiamo che il torque è dato da:

$$T = FR_d = 2K_e i$$
Possiamo misurare la corrente del motore attraverso l'output current del blocco del motore su simulink.

Rieseguiamo l'esperimento test1, e salviamo l'output della corrente in una variabile di matlab $i$ (gia' fatto nello shcema).

A regime $F=F_0$. Prendiamo l'ultimo sample della corrente, che sarà $i(N)$. Nota che su matlab la corrente viene salvata nella struttura $i$ . per accedere ai dati devi fare $i.Data$.

 Quindi:
$$K_e = \frac{FR_d}{2i_N}$$

Per stimare $\gamma$ sappiamo che vale:
$$\gamma = \frac{4K_e^2}{R_d^2M}$$

Sappiamo che se fosse $\gamma \ll 1$ allora il sistema sarebbe un passabasso, quindi per ingresso costante $V_0=3.6$ otteniamo una risposta del tipo:
$$i(t) = \frac{3.6}{2R}(1-e^{-\frac{R}{L}t})$$
Di conseguenza esegui il test1, controlla la corrente e fanne un plot. Se ha la forma del tipo $1-e^{-t}$ allora è un passabasso.

$R_d$ è dato dal manuale, in pollici. Inoltre sappiamo che $M > 0.5Kg$
Di conseguenza dobbiamo vedere quando:
$$\gamma \ll 1 \approx \gamma < 0.1$$

Sia $ x= \frac{4K_e^2}{R_d^2}$, quindi maggiorando:
$$ \frac{x}{M} < \frac{x}{0.5}$$
e imponiamo ora la condizione
$$\frac{x}{0.5}<0.1 \Rightarrow x < 0.05$$

Quindi calcola $ x= \frac{4K_e^2}{R_d^2}$ e vedi se vale meno di $0.05$.

\newpage
\section{Ricavare la resistenza del motore}
Per ricavare il guadagno del motore conviene sfruttare il fatto che possiamo misurare la corrente del motore attraverso l'output current del blocco del motore su simulink. \\ \\
Considerando la back-emf la funzione di trasferimento è data da:
$$\frac{I}{V}(s) = \frac{s^2+\frac{K}{M}}{(s^2+\frac{K}{M})(2R+2sL)+\gamma }$$
$$\gamma = \frac{4K_e^2}{R_d^2M}$$
Per $V=V_0$ (nota che nello schema $V_0=3.6$) costante otteniamo:
$$\lim_{t \to \infty} i(t) = \lim_{s \to 0} sI(s)\frac{1}{s} = \frac{3.6}{2R}$$
Quindi prendiamo l'ultimo campione della corrente (che chiamo $i_N$), e di conseguenza:
$$R = \frac{3.6}{2i_N}$$
Quindi esegui le seguenti istruzioni:
\begin{enumerate}
\item Esegui il test 1
\item $i=i.Data;$
\item $N=length(i);$
\item $ R = 3.6/(2*i(N));$
\end{enumerate}
\section{Ricavare l'induttanza del motore e la costante di tempo}
Come al solito:
$$\frac{I}{V}(s) = \frac{s^2+\frac{K}{M}}{(s^2+\frac{K}{M})(2R+2sL)+\gamma }$$
$$\gamma = \frac{4K_e^2}{R_d^2M}$$
Della funzione di trasferimento ancora non sappiamo $M,L$. Rieseguiamo il file test nella cartella. Abbiamo due casi:
\begin{enumerate}
\item $\gamma \ll 1 \Rightarrow$ possiamo fare l'approssimazione del sistema a un passabasso come indicato nella prima pagina di questo pdf.
\item $\gamma \gg 0$ Non possiamo fare l'approssimazione del sistema a un passabasso.
\end{enumerate}
Sappiamo che se fosse $\gamma \ll 1$ allora il sistema sarebbe un passabasso con 1 polo, quindi per ingresso costante $V_0$ otteniamo una risposta del tipo:
$$i(t) = \frac{V_0}{2R}(1-e^{-\frac{R}{L}t})$$
Di conseguenza esegui il test, controlla la corrente e fanne un plot. Se ha la forma del tipo $1-e^(-t)$ allora è un passabasso. \\ \\

Inoltre prima abbiamo stimato $K_e$. Se abbiamo sia $\gamma \ll 1 $ e la corrente che sembra abbia la forma del tipo $1-e^(-t)$ allora puoi continuare con la sottosezione 1, senno vai alla sottosezione 2.
\subsection{Procedura 1:white box identification}
Questo è il caso in cui la funzione di trasferimento è approssimabile a un passabasso con 1 polo. Se sei a questo punto dovresti aver verificato che $\gamma \ll 1$ e che la corrente per $V=V_0$ ha un andamento del tipo $1-e^(-t)$. \\  \\
Di conseguenza per $V=V_0$ (ricorda che $V_0=3.6$ otteniamo che la corrente è:
$$i(t) = \frac{V_0}{2R}(1-e^{-\frac{R}{L}t})$$
Sappiamo che per:
$$\frac{R}{L}t > 6 \Rightarrow e^{-\frac{R}{L}t} < \frac{1}{400}$$
Quindi :
$$\frac{V_0}{2R} - i(t) = \frac{V_0}{2R}e^{-\frac{R}{L}t}$$
Bisogna vedere quadno:
$$\frac{V_0}{2R}e^{-\frac{R}{L}t}= \frac{V_0}{2R} - i(t) < \frac{V_0}{2R}e^{-6}$$
Che equivale alla condizione:
$$1- \frac{i(t)2R}{V0} < e^{-6}$$
Una volta ricavato per quale primo valore di $t$ vale, allora chiamato $t_0$ questo valore abbiamo:
$$\frac{R}{L}t_0 \approx 6 \Rightarrow L = \frac{R}{6}t_0$$\\ \\

Una volta ricavato questo, per sicurezza,  esegui i seguenti comandi per vedere se ottieni lo stesso risultato:
\begin{enumerate}
\item Esegui test1
\item $in=v.Data$
\item $out = i.Data$
\item $dat = iddata(out,in, 0.0001)$ dove out è la corrente, in è la tensione in ingresso, ts è il sampling time.
\item $g = tfest(dat, 1)$ dovresti ottenere una funzione passabasso con polo in $\frac{R}{L}$ (e guadagno sballato forse).
\end{enumerate}

\subsection{Procedura 2: Grey box identification}
Per stimare dai dati la funzione di trasferimento bisogna fare grey box identification. Avrai bisogno del file test2.\\ \\Sappiamo che la fdt ha 3 poli. Bisogna Inanzitutto eccitare il sistema. Dato che in generale comunque il sistema è passabasso, possiamo mandare un esponenziale negativo in ingressoo al sistema. Questo esponenziale deve avere banda maggiore rispetto alla banda del sistema, guadagno 1. Inoltre dobbiamo campionare a una frequenza che è almeno 2 volte quella del segnale in ingresso, che è maggiore rispetto a quella del sistema, quindi il criterio di nyquist è apposto. Per convenienza nel test 2 ho inserito un esponenziale con banda $1000rad/s$ e campionamento $10^4 hz$. In questo modo per $\omega < 500 rad/sec$ abbiamo la fdt del sistema, che è la banda di interesse. (Se ci sono problemi ovviamente abbassiamo la banda, chiedimi come fare nel caso, dato che fino a 500rad/sec è tanto). \\
Quindi devi fare:
\begin{enumerate}
\item Carica test2 sulla scheda
\item Quando sei pronto aziona sia la levetta 2 che la levetta 3 della scheda. Aspetta che il carretto torni in 0.
\item $dat = iddata(out,in, 0.0001)$ dove out è la corrente, in è la tensione in ingresso, ts è il sampling time.
\item $g = tfest(dat, 3)$
\end{enumerate}
Ho messo $3$ perchè $\gamma \gg 0$ quindi abbiamo $3$ poli.
\section{Stimare la massa}
Consideriamo la funzione di trasferimento fra $F(s)$ e $X(s)$:
$$X(s)= \frac{1}{M}\frac{1}{s^2+\frac{K}{M}}F(s)$$
Dove $F(s) = \frac{N}{D}(s)$. Supponiamo $F$ quasi costante, quindi approssimabile a $\frac{1}{s}$. Per i fratti semplici otteniamo:
$$(x) = \frac{As+B}{s^2+\frac{K}{M}}+\cdots$$
Dove $\cdots$ intende fratti dipendenti $F(s)$. Sappiamo che il primo fratto è il termine del transitorio, mentre $\cdots$  indica i termini a regime che dovrebbe essere approssimabile a $\frac{C}{s}$. \\ \\
Quindi nel transitorio abbiamo una sinusoide (smorzata perchè comunque lo smorzamento c'è anche se non modellato, ma non influisce sulla frequenza di oscillazione) con pulsazione $\omega = \sqrt{\frac{K}{M}}$. Quindi esegui il test1 con $V=3.6$ costante, guarda l'encoder e misura il periodo fra le due sinusoidi:
$$\frac{2\pi}{T}= \sqrt{\frac{K}{M}} \Rightarrow M = \frac{KT^2}{4\pi^2}$$
Dovrebbe venire $M > 0.5kg$.
\end{document}